
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../thermal_conductivity/">
      
      
        <link rel="next" href="../phonon_dispersion_relations/">
      
      <link rel="icon" href="../../media/matematico_favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Anharmonic free energy - TDEP</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CDroid+Sans+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Droid Sans Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="Teal" data-md-color-accent="Blue-Grey">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#short-description" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TDEP" class="md-header__button md-logo" aria-label="TDEP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TDEP
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Anharmonic free energy
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../atomic_distribution/" class="md-tabs__link">
        Currently trying to fix programs
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../lineshape/" class="md-tabs__link md-tabs__link--active">
        Catastrophic programs
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../extract_forceconstants/" class="md-tabs__link">
        Decent programs
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../files/" class="md-tabs__link">
      Files
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TDEP" class="md-nav__button md-logo" aria-label="TDEP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    TDEP
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Currently trying to fix programs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Currently trying to fix programs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../atomic_distribution/" class="md-nav__link">
        Atomic distribution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Catastrophic programs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Catastrophic programs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lineshape/" class="md-nav__link">
        Lineshape
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thermal_conductivity/" class="md-nav__link">
        Thermal conductivity
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Anharmonic free energy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Anharmonic free energy
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#short-description" class="md-nav__link">
    Short description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-options" class="md-nav__link">
    Command line options:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#free-energy" class="md-nav__link">
    Free energy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#second-order-terms" class="md-nav__link">
    Second order terms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#higher-order-terms" class="md-nav__link">
    Higher order terms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baseline-renormalization" class="md-nav__link">
    Baseline renormalization
  </a>
  
    <nav class="md-nav" aria-label="Baseline renormalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-the-free-energy-with-tdep" class="md-nav__link">
     Determining the free energy with TDEP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-does-this-code-not-output-entropy" class="md-nav__link">
    Why does this code not output entropy?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harmonic-thermodynamics" class="md-nav__link">
    Harmonic thermodynamics
  </a>
  
    <nav class="md-nav" aria-label="Harmonic thermodynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-the-free-energy-with-tdep_1" class="md-nav__link">
     Determining the free energy with TDEP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harmonic-thermodynamics_1" class="md-nav__link">
    Harmonic thermodynamics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    Output files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../phonon_dispersion_relations/" class="md-nav__link">
        Phonon dispersion relations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Decent programs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Decent programs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../extract_forceconstants/" class="md-nav__link">
        Extract forceconstants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pack_simulation/" class="md-nav__link">
        Pack simulation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../generate_structure/" class="md-nav__link">
        Generate structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crystal_structure_info/" class="md-nav__link">
        Crystal structure info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../canonical_configuration/" class="md-nav__link">
        Canonical configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../samples_from_md/" class="md-nav__link">
        Samples from MD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../refine_structure/" class="md-nav__link">
        Refine structure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../files/" class="md-nav__link">
        Files
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#short-description" class="md-nav__link">
    Short description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-line-options" class="md-nav__link">
    Command line options:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#free-energy" class="md-nav__link">
    Free energy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#second-order-terms" class="md-nav__link">
    Second order terms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#higher-order-terms" class="md-nav__link">
    Higher order terms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baseline-renormalization" class="md-nav__link">
    Baseline renormalization
  </a>
  
    <nav class="md-nav" aria-label="Baseline renormalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-the-free-energy-with-tdep" class="md-nav__link">
     Determining the free energy with TDEP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-does-this-code-not-output-entropy" class="md-nav__link">
    Why does this code not output entropy?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harmonic-thermodynamics" class="md-nav__link">
    Harmonic thermodynamics
  </a>
  
    <nav class="md-nav" aria-label="Harmonic thermodynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#determining-the-free-energy-with-tdep_1" class="md-nav__link">
     Determining the free energy with TDEP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#harmonic-thermodynamics_1" class="md-nav__link">
    Harmonic thermodynamics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    Output files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Anharmonic free energy</h1>

<h3 id="short-description">Short description</h3>
<p>End world hunger!</p>
<h3 id="command-line-options">Command line options:</h3>
<p>Optional switches:</p>
<ul>
<li>
<p><code>--temperature value</code><br />
    default value 300<br />
    Temperature used in the occupation numbers. Should be the same as the temperature the force constants where determined at.</p>
</li>
<li>
<p><code>--qpoint_grid value#1 value#2 value#3</code>, <code>-qg value#1 value#2 value#3</code><br />
    default value 26 26 26<br />
    Density of q-point mesh for Brillouin zone integrations.</p>
</li>
<li>
<p><code>--integrationtype value</code>, <code>-it value</code>, value in: <code>1,2,3</code><br />
    default value 2<br />
    Type of integration. 1 is Gaussian, 2 adaptive Gaussian and 3 Tetrahedron.</p>
</li>
<li>
<p><code>--sigma value</code><br />
    default value 1.0<br />
    Global scaling factor for Gaussian/adaptive Gaussian smearing. The default is determined procedurally, and scaled by this number.</p>
</li>
<li>
<p><code>--path</code><br />
    default value .false.
    mutually exclude "--temperature_range"<br />
    Calculate the anharmonic free energy on a path through the BZ.</p>
</li>
<li>
<p><code>--support_qpoint_grid value#1 value#2 value#3</code>, <code>-sqg value#1 value#2 value#3</code><br />
    default value -1 -1 -1<br />
    Interpolate to a (preferrably) denser q-mesh when calculating the DOS.</p>
</li>
<li>
<p><code>--temperature_range value#1 value#2 value#3</code><br />
    default value -1 -1 -1
    mutually exclude "--path"<br />
    Evaluate thermodynamic phonon properties for a series of temperatures, specify min, max and the number of points.</p>
</li>
<li>
<p><code>--readiso</code><br />
    default value .false.<br />
    Read the isotope distribution from file</p>
</li>
<li>
<p><code>--meshtype value</code>, value in: <code>1,2,3,4</code><br />
    default value 1<br />
    Type of q-point mesh. 1 Is a Monkhorst-Pack mesh, 2 an FFT mesh and 3 my fancy wedge-based mesh with approximately the same density the grid-based meshes. 4 build the commensurate mesh of an approximately cubic supercell.</p>
</li>
<li>
<p><code>--readqmesh</code><br />
    default value .false.<br />
    Read the q-point mesh from file. To generate a q-mesh file, see the genkpoints utility.</p>
</li>
<li>
<p><code>--help</code>, <code>-h</code><br />
    Print this help message</p>
</li>
<li>
<p><code>--version</code>, <code>-v</code><br />
    Print version</p>
</li>
</ul>
<h3 id="examples">Examples</h3>
<p><code>mpirun anharmonic_free_energy</code> </p>
<p>This code calculates the anharmonic Helmholtz free energy. It includes the contributions from baseline shifts, renormalized phonons and higher order terms.</p>
<h3 id="free-energy">Free energy</h3>
<p>@todo Explain the basics of free energy, entropies and so on.</p>
<h2 id="second-order-terms">Second order terms</h2>
<p>The details an notation how to calculate phonon can be found <a href="../phonon_dispersion_relations/">phonon_dispersion_relations</a>, and I follow the same notation here. In the previous section, we treated the vibrations of atoms classically, by solving Newton's equations of motion. Quantum-mechanically, vibrational normal modes can be represented as quasi-particles called phonons, quanta of thermal energy. We note that our normal mode transformation is a sum over eigenfunctions of independent harmonic oscillators. This allows us to write the position and momentum operators in terms of creation and annihilation operators (without loss of generality, we can contract the notation for phonon mode <span class="arithmatex">\(s\)</span> at wave vector <span class="arithmatex">\(\mathbf{q}\)</span> to a single index <span class="arithmatex">\(\lambda\)</span>):</p>
<div class="arithmatex">\[
\begin{align}
\hat{u}_{i\alpha} = &amp; \sqrt{ \frac{\hbar}{2N m_\alpha} }
\sum_\lambda \frac{\epsilon_\lambda^{i\alpha}}{ \sqrt{ \omega_\lambda} }
e^{i\mathbf{q}\cdot\mathbf{r}_i}
\left( \hat{a}^{\mathstrut}_\lambda + \hat{a}^\dagger_\lambda \right) \\
%
\hat{p}_{i\alpha} = &amp; \sqrt{ \frac{\hbar m_\alpha}{2N} }
\sum_\lambda \sqrt{ \omega_\lambda } \epsilon_\lambda^{i\alpha}
e^{i\mathbf{q}\cdot\mathbf{r}_i-\pi/2}
\left( \hat{a}^{\mathstrut}_\lambda - \hat{a}^\dagger_\lambda \right)
%
\end{align}
\]</div>
<p>and their inverse</p>
<div class="arithmatex">\[
\begin{align}
\hat{a}^{\mathstrut}_{\lambda} = &amp; \frac{1}{\sqrt{2N\hbar}}
\sum_{i\alpha} \epsilon_\lambda^{i\alpha}
e^{-i\mathbf{q}\cdot\mathbf{r}_i} \left( \sqrt{m_i \omega_\lambda} \hat{u}_{i\alpha}-i \frac{\hat{p}_{i\alpha}}{ \sqrt{ m_i \omega_\lambda }} \right) \\
%
\hat{a}^\dagger_{\lambda} = &amp; \frac{1}{\sqrt{2N\hbar}}
\sum_{i\alpha} \epsilon_\lambda^{i\alpha}
e^{i\mathbf{q}\cdot\mathbf{r}_i} \left( \sqrt{m_i \omega_\lambda} \hat{u}_{i\alpha}-i \frac{\hat{p}_{i\alpha}}{ \sqrt{ m_i \omega_\lambda }} \right)
\end{align}
\]</div>
<p>In terms of these operators, the vibrational Hamiltonian can be written as</p>
<div class="arithmatex">\[
\begin{equation}
\hat{H}=\sum_{\lambda}\hbar\omega_\lambda \left( \hat{a}^\dagger_\lambda \hat{a}^{\mathstrut}_\lambda + \frac{1}{2}\right)\,.
\end{equation}
\]</div>
<p>Since <span class="arithmatex">\(\hat{a}^\dagger_\lambda \hat{a}^{\mathstrut}_\lambda\)</span> are commutative operators, the Hamiltonian is that of a sum of uncoupled harmonic quantum oscillators, each having the partition function</p>
<div class="arithmatex">\[
\begin{equation}
Z_{\lambda}=\sum_{n=0}^{\infty}e^{-\beta (n +\frac{1}{2})\hbar\omega_{\lambda} } =
\frac{ e^{-\beta \hbar\omega_{\lambda}/2 } }{1-e^{-\beta \hbar\omega_{\lambda}}}
\end{equation}
\]</div>
<p>that gives the total partition function</p>
<div class="arithmatex">\[
\begin{equation}
Z=\prod_{\lambda} \frac{ e^{-\beta \hbar\omega_{\lambda}/2 } }{1-e^{-\beta \hbar\omega_{\lambda}}}.
\end{equation}
\]</div>
<p>From this we can get the Helmholtz (phonon) free energy:</p>
<div class="arithmatex">\[
\begin{equation}
F_{\textrm{ph}}= -k_B T \ln Z = \sum_{\lambda} \frac{\hbar \omega_{\lambda}}{2}+k_B T%
\ln \left( 1- \exp \left( -\frac{\hbar \omega_{\lambda}}{k_B T} \right) \right)
\end{equation}
\]</div>
<p>@todo copy-paste from thesis or something</p>
<h2 id="higher-order-terms">Higher order terms</h2>
<p>@todo copy-paste from paper</p>
<h2 id="baseline-renormalization">Baseline renormalization</h2>
<p>In the conventional quasiharmonic approximation, the total free energy of the system (not considering any terms pertaining to magnetic or configurational degrees of freedom) can be expressed as</p>
<div class="arithmatex">\[
\begin{equation}
    F = F_{\textrm{el}} + F_{\textrm{ph}}\,.
\end{equation}
\]</div>
<p>In the TDEP formalism it is not quite that simple.</p>
<h4 id="determining-the-free-energy-with-tdep"><a name="sec_tdepthermo"></a> Determining the free energy with TDEP</h4>
<p>In the TDEP formalism,<sup id="fnref:Hellman2013"><a class="footnote-ref" href="#fn:Hellman2013">4</a></sup><sup>,</sup><sup id="fnref:Hellman2013a"><a class="footnote-ref" href="#fn:Hellman2013a">3</a></sup><sup>,</sup><sup id="fnref:Hellman2011"><a class="footnote-ref" href="#fn:Hellman2011">2</a></sup> with effective force constants, the phonon quasiparticles are different at each temperature. At fix temperature, they behave just like normal bosons, obeying Bose-Einstein statistics and so on. But changing the temperature will change both the occupation numbers and the states that are occupied. Moreover, in the harmonic approximation the baseline energy (with all atoms at their equilibrium positions) is that of the static lattice. With an effective Hamiltonian this baseline is a free parameter. The baseline shift is illustrated in the diagram below:</p>
<p><center><img src="../media/explain_U0.png" width="600" /></center></p>
<p>The density depicts the phase space samples used to fit the effective Hamiltonian. The reference energy, or baseline, has been shifted with respect to zero temperature. This baseline is determined by matching the potential energies of the samples of the Born-Oppenheimer surface, <span class="arithmatex">\(U_{BO}\)</span>, and the potential energy of the TDEP model Hamiltonian:</p>
<div class="arithmatex">\[
\begin{equation}
\begin{split}
    \left\langle U_{\textrm{BO}} - U_{\textrm{TDEP}} \right\rangle &amp; =
    \left\langle U_{\textrm{BO}} - U_0 -\frac{1}{2} \sum_{ij} \sum_{\alpha\beta} \Phi_{ij}^{\alpha\beta} u^{\alpha}_i u^{\beta}_j  \right\rangle = 0 \\
    U_0 &amp; = \left\langle U_{\textrm{BO}} - \frac{1}{2} \sum_{ij} \sum_{\alpha\beta} \Phi_{ij}^{\alpha\beta} u^{\alpha}_i u^{\beta}_j \right\rangle
\end{split}
\end{equation}
\]</div>
<p>Intuitively, this can be interpreted as that the TDEP force constants are determined by matching forces between the real and model system, in a similar manner we match the energies as well. The new baseline is conveniently expressed as a shift:</p>
<div class="arithmatex">\[
\begin{equation}
    \Delta U = U_0-U_{\textrm{stat}}
\end{equation}
\]</div>
<p>Where <span class="arithmatex">\(U_{\textrm{stat}}\)</span> is the energy of the perfect lattice at 0K. The free energy is then (excluding configurational entropy, magnetic entropy etc.)</p>
<div class="arithmatex">\[
\begin{equation}
    F = F_{\textrm{el}} + F_{\textrm{ph}} + \Delta U_0\,.
\end{equation}
\]</div>
<h3 id="why-does-this-code-not-output-entropy">Why does this code not output entropy?</h3>
<p>@todo Refer to Cowley</p>
<p>@todo Simple explanation with partial derivatives</p>
<p>@todo Plot with heat capacity</p>
<h3 id="harmonic-thermodynamics">Harmonic thermodynamics</h3>
<p>In the previous section, we treated the vibrations of atoms classically, by solving Newton's equations of motion. Quantum-mechanically, vibrational normal modes can be represented as quasi-particles called phonons, quanta of thermal energy. We note that our normal mode transformation is a sum over eigenfunctions of independent harmonic oscillators. This allows us to write the position and momentum operators in terms of creation and annihilation operators (without loss of generality, we can contract the notation for phonon mode <span class="arithmatex">\(s\)</span> at wave vector <span class="arithmatex">\(\mathbf{q}\)</span> to a single index <span class="arithmatex">\(\lambda\)</span>):</p>
<div class="arithmatex">\[
\begin{align}
\hat{u}_{i\alpha} = &amp; \sqrt{ \frac{\hbar}{2N m_\alpha} }
\sum_\lambda \frac{\epsilon_\lambda^{i\alpha}}{ \sqrt{ \omega_\lambda} }
e^{i\mathbf{q}\cdot\mathbf{r}_i}
\left( \hat{a}^{\mathstrut}_\lambda + \hat{a}^\dagger_\lambda \right) \\
%
\hat{p}_{i\alpha} = &amp; \sqrt{ \frac{\hbar m_\alpha}{2N} }
\sum_\lambda \sqrt{ \omega_\lambda } \epsilon_\lambda^{i\alpha}
e^{i\mathbf{q}\cdot\mathbf{r}_i-\pi/2}
\left( \hat{a}^{\mathstrut}_\lambda - \hat{a}^\dagger_\lambda \right)
%
\end{align}
\]</div>
<p>and their inverse</p>
<div class="arithmatex">\[
\begin{align}
\hat{a}^{\mathstrut}_{\lambda} = &amp; \frac{1}{\sqrt{2N\hbar}}
\sum_{i\alpha} \epsilon_\lambda^{i\alpha}
e^{-i\mathbf{q}\cdot\mathbf{r}_i} \left( \sqrt{m_i \omega_\lambda} \hat{u}_{i\alpha}-i \frac{\hat{p}_{i\alpha}}{ \sqrt{ m_i \omega_\lambda }} \right) \\
%
\hat{a}^\dagger_{\lambda} = &amp; \frac{1}{\sqrt{2N\hbar}}
\sum_{i\alpha} \epsilon_\lambda^{i\alpha}
e^{i\mathbf{q}\cdot\mathbf{r}_i} \left( \sqrt{m_i \omega_\lambda} \hat{u}_{i\alpha}-i \frac{\hat{p}_{i\alpha}}{ \sqrt{ m_i \omega_\lambda }} \right)
\end{align}
\]</div>
<p>In terms of these operators, the vibrational Hamiltonian can be written as</p>
<div class="arithmatex">\[
\begin{equation}
\hat{H}=\sum_{\lambda}\hbar\omega_\lambda \left( \hat{a}^\dagger_\lambda \hat{a}^{\mathstrut}_\lambda + \frac{1}{2}\right)\,.
\end{equation}
\]</div>
<p>Since <span class="arithmatex">\(\hat{a}^\dagger_\lambda \hat{a}^{\mathstrut}_\lambda\)</span> are commutative operators, the Hamiltonian is that of a sum of uncoupled harmonic quantum oscillators, each having the partition function</p>
<div class="arithmatex">\[
\begin{equation}
Z_{\lambda}=\sum_{n=0}^{\infty}e^{-\beta (n +\frac{1}{2})\hbar\omega_{\lambda} } =
\frac{ e^{-\beta \hbar\omega_{\lambda}/2 } }{1-e^{-\beta \hbar\omega_{\lambda}}}
\end{equation}
\]</div>
<p>that gives the total</p>
<div class="arithmatex">\[
\begin{equation}
Z=\prod_{\lambda} \frac{ e^{-\beta \hbar\omega_{\lambda}/2 } }{1-e^{-\beta \hbar\omega_{\lambda}}}.
\end{equation}
\]</div>
<p>From this we can get the Helmholtz (phonon) free energy:</p>
<div class="arithmatex">\[
\begin{equation}
F_{\textrm{ph}}= -k_B T \ln Z = \sum_{\lambda} \frac{\hbar \omega_{\lambda}}{2}+k_B T%
\ln \left( 1- \exp \left( -\frac{\hbar \omega_{\lambda}}{k_B T} \right) \right)
\end{equation}
\]</div>
<p>In the conventional quasiharmonic approximation, the total free energy of the system (not considering any terms pertaining to magnetic or configurational degrees of freedom) can be expressed as</p>
<div class="arithmatex">\[
\begin{equation}
    F = F_{\textrm{el}} + F_{\textrm{ph}}\,.
\end{equation}
\]</div>
<p>In the TDEP formalism it is not quite that simple.</p>
<h4 id="determining-the-free-energy-with-tdep_1"><a name="sec_tdepthermo"></a> Determining the free energy with TDEP</h4>
<p>In the TDEP formalism,<sup id="fnref2:Hellman2013"><a class="footnote-ref" href="#fn:Hellman2013">4</a></sup><sup>,</sup><sup id="fnref2:Hellman2013a"><a class="footnote-ref" href="#fn:Hellman2013a">3</a></sup><sup>,</sup><sup id="fnref2:Hellman2011"><a class="footnote-ref" href="#fn:Hellman2011">2</a></sup> with effective force constants, the phonon quasiparticles are different at each temperature. At fix temperature, they behave just like normal bosons, obeying Bose-Einstein statistics and so on. But changing the temperature will change both the occupation numbers and the states that are occupied. Moreover, in the harmonic approximation the baseline energy (with all atoms at their equilibrium positions) is that of the static lattice. With an effective Hamiltonian this baseline is a free parameter. The baseline shift is illustrated in the diagram below:</p>
<p><center><img src="../media/explain_U0.png" width="600" /></center></p>
<p>The density depicts the phase space samples used to fit the effective Hamiltonian. The reference energy, or baseline, has been shifted with respect to zero temperature. This baseline is determined by matching the potential energies of the samples of the Born-Oppenheimer surface, <span class="arithmatex">\(U_{BO}\)</span>, and the potential energy of the TDEP model Hamiltonian:</p>
<div class="arithmatex">\[
\begin{equation}
\begin{split}
    \left\langle U_{\textrm{BO}} - U_{\textrm{TDEP}} \right\rangle &amp; =
    \left\langle U_{\textrm{BO}} - U_0 -\frac{1}{2} \sum_{ij} \sum_{\alpha\beta} \Phi_{ij}^{\alpha\beta} u^{\alpha}_i u^{\beta}_j  \right\rangle = 0 \\
    U_0 &amp; = \left\langle U_{\textrm{BO}} - \frac{1}{2} \sum_{ij} \sum_{\alpha\beta} \Phi_{ij}^{\alpha\beta} u^{\alpha}_i u^{\beta}_j \right\rangle
\end{split}
\end{equation}
\]</div>
<p>Intuitively, this can be interpreted as that the TDEP force constants are determined by matching forces between the real and model system, in a similar manner we match the energies as well. The new baseline is conveniently expressed as a shift:</p>
<div class="arithmatex">\[
\begin{equation}
    \Delta U = U_0-U_{\textrm{stat}}
\end{equation}
\]</div>
<p>Where <span class="arithmatex">\(U_{\textrm{stat}}\)</span> is the energy of the perfect lattice at 0K. The free energy is then (excluding configurational entropy, magnetic entropy etc.)</p>
<div class="arithmatex">\[
\begin{equation}
    F = F_{\textrm{el}} + F_{\textrm{ph}} + \Delta U_0\,.
\end{equation}
\]</div>
<p>The entropy and heat capacity is not accessible from a single simulation. Since both the phonon free energy and baseline shift have non-trivial temperature dependencies, a series of calculations for different temperatures are needed, so that the entropy can be calculated via</p>
<div class="arithmatex">\[
\begin{equation}
    S = -\left.\frac{dF}{dT}\right|_{V}
\end{equation}
\]</div>
<p>A series of calculations on a volume-temperature grid is required to calculate Gibbs free energy, with pressure explicitly calculated as</p>
<div class="arithmatex">\[
\begin{equation}
    P = -\left.\frac{dF}{dV}\right|_T
\end{equation}
\]</div>
<h3 id="harmonic-thermodynamics_1">Harmonic thermodynamics</h3>
<p>The entropy and heat capacity is not accessible from a single simulation. Since both the phonon free energy and baseline shift have non-trivial temperature dependencies, a series of calculations for different temperatures are needed, so that the entropy can be calculated via</p>
<div class="arithmatex">\[
\begin{equation}
    S = -\left._{}\frac{dF}{dT}\right|_{V}
\end{equation}
\]</div>
<p>A series of calculations on a volume-temperature grid is required to calculate Gibbs free energy, with pressure explicitly calculated as</p>
<div class="arithmatex">\[
\begin{equation}
    P = -\left._{}\frac{dF}{dV}\right|_{T}
\end{equation}
\]</div>
<p>Or something.</p>
<h3 id="output-files">Output files</h3>
<p>Using option <code>--dumpgrid</code> writes all phonon properties for a grid in the BZ to an hdf5 file, that is self-documented.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:Born1998">
<p>Born, M., &amp; Huang, K. (1964). Dynamical theory of crystal lattices. Oxford: Oxford University Press.&#160;<a class="footnote-backref" href="#fnref:Born1998" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:Hellman2011">
<p><a href="http://doi.org/10.1103/PhysRevB.84.180301">Hellman, O., Abrikosov, I. A., &amp; Simak, S. I. (2011). Lattice dynamics of anharmonic solids from first principles. Physical Review B, 84(18), 180301.</a>&#160;<a class="footnote-backref" href="#fnref:Hellman2011" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:Hellman2011" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:Hellman2013a">
<p><a href="http://doi.org/10.1103/PhysRevB.88.144301">Hellman, O., &amp; Abrikosov, I. A. (2013). Temperature-dependent effective third-order interatomic force constants from first principles. Physical Review B, 88(14), 144301.</a>&#160;<a class="footnote-backref" href="#fnref:Hellman2013a" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:Hellman2013a" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:Hellman2013">
<p><a href="http://doi.org/10.1103/PhysRevB.87.104111">Hellman, O., Steneteg, P., Abrikosov, I. A., &amp; Simak, S. I. (2013). Temperature dependent effective potential method for accurate free energy calculations of solids. Physical Review B, 87(10), 104111.</a>&#160;<a class="footnote-backref" href="#fnref:Hellman2013" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:Hellman2013" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:Gonze1994">
<p><a href="https://link.aps.org/doi/10.1103/PhysRevB.50.13035">Gonze, X., Charlier, J.-C., Allan, D. C. &amp; Teter, M. P. Interatomic force constants from first principles: The case of α-quartz. Phys. Rev. B 50, 13035–13038 (1994).</a>&#160;<a class="footnote-backref" href="#fnref:Gonze1994" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:Gonze1997">
<p><a href="http://link.aps.org/doi/10.1103/PhysRevB.55.10355">Gonze, X. &amp; Lee, C. Dynamical matrices, Born effective charges, dielectric permittivity tensors, and interatomic force constants from density-functional perturbation theory. Phys. Rev. B 55, 10355–10368 (1997).</a>&#160;<a class="footnote-backref" href="#fnref:Gonze1997" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
</ol>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../javascripts/mathjax.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  </body>
</html>